riot.tag2("main",'<div if="{tool}" class="container"><div class="help-tip hide-phone"><p> The build tool can be changed using the hamburger menu on the left. For more information about this tool please visit <a href="{tool.url}">{tool.id}</a> website.<br><br> This is a progressive webapp, meaning that you can add it to your desktop and it can even run offline. You can boostrap your project even on the go without internet! </p></div><h1>{tool.id}: {tool.file}</h1><form onsubmit="{generate}"><div each="{f, i in tool.fields}" class="row"><virtual if="{i % 2 === 0}"><div class="col-6"><input name="{tool.fields[i].key}" type="text" placeholder="{tool.fields[i].label + (tool.fields[i].prefill ? \' e.g.: \' + tool.fields[i].prefill : \'\')}" required="{tool.fields[i].required}"></div><div class="col-6"><input if="{tool.fields[i+1]}" name="{tool.fields[i+1].key}" type="text" placeholder="{tool.fields[i+1].label + (tool.fields[i+1].prefill ? \' e.g.: \' + tool.fields[i+1].prefill : \'\')}" required="{tool.fields[i+1].required}"></div></virtual></div><div if="{tool.languages || presets}" class="row"><div class="col-6"><select id="language" disabled="{!tool.languages || tool.languages.length == 0}" onchange="{changeLanguage}"><option each="{tool.languages}" riot-value="{id}">{id}</option></select></div><div class="col-6"><select id="preset" disabled="{!presets || presets.length == 0}" onchange="{changePreset}"><option value="">Empty Project</option><option each="{presets}" riot-value="{id}">{id}</option></select></div></div><div class="row"><div class="col-6"><h1>Dependencies</h1></div><div class="col-6"><div class="help-tip hide-phone"><p>Use this box to search for dependencies to add to your application, if a dependency is not present, please <a href="https://github.com/pmlopes/vertx-starter/issues/new">open an issue</a> so we can add the missing metadata!</p></div><input type="text" class="pull-right" placeholder="Search dependency..." onkeyup="{search}"></div></div><div each="{c, i in dependencies}" class="row"><virtual if="{i % 2 == 0}"><div class="col-6"><div class="{dependency: dependencies[i].checked}"><input name="dependencies" type="checkbox" riot-value="{i}" checked="{dependencies[i].checked}" onclick="{toggleDependency}"><div><span if="{dependencies[i].stack}" class="pull-right"><img src="img/stack.svg" width="16px"></span><strong>{dependencies[i].artifactId}</strong><hr><p if="{dependencies[i].description}">{dependencies[i].description}</p></div><br></div></div><div class="col-6"><div if="{dependencies[i+1]}" class="{dependency: dependencies[i+1].checked}"><input name="dependencies" type="checkbox" riot-value="{i+1}" checked="{dependencies[i+1].checked}" onclick="{toggleDependency}"><div><span if="{dependencies[i+1].stack}" class="pull-right"><img src="img/stack.svg" width="16px"></span><strong>{dependencies[i+1].artifactId}</strong><hr><p if="{dependencies[i+1].description}">{dependencies[i+1].description}</p></div><br></div></div></virtual></div><div class="row" id="interaction"><div class="col-8"><button name="submit" type="submit">Generate</button> &nbsp; <a id="download-btn" onclick="{clean}" href="#" show="{downloading}" ref="download" download="{name}.zip" style="padding: 1.1rem 3.5rem; margin: 1rem 0; background: #782b90; color: #f5f5f5; border-radius: 2px; border: none; font-size: 1.3rem; transition: all .2s ease">Download</a></div><div class="col-4"><div if="{generating}" class="spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div></div></div></form><div class="row"><div class="center"><span>powered with <span style="color:#f00000">&lt;3</span> by <a href="https://github.com/pmlopes/vertx-starter/tree/gh-pages">github.com</a></span></div></div></div>',"","",function(e){function t(t){var n=route.query(),d={dependencies:(decodeURIComponent(n.dependencies)||"").split(",")};if(t.languages){ga("send",{hitType:"event",eventCategory:t.id+":view",eventAction:t.id+"/view",eventLabel:"project"});var o=[];e.components.forEach(function(e,i){var n;return-1!==d.dependencies.indexOf(e.groupId+":"+e.artifactId+(e.classifier?":"+e.classifier:""))?(n=clone(e),n.checked=!0,n.id=i,void o.push(n)):-1!==d.dependencies.indexOf(e.groupId+":"+e.artifactId)?(n=clone(e),n.checked=!0,n.id=i,void o.push(n)):-1!==t.defaults.indexOf(e.groupId+":"+e.artifactId+(e.classifier?":"+e.classifier:""))?(n=clone(e),n.checked=!0,n.id=i,void o.push(n)):-1!==t.defaults.indexOf(e.groupId+":"+e.artifactId)?(n=clone(e),n.checked=!0,n.id=i,void o.push(n)):void 0}),a.update({downloading:!1,tool:t,presets:i(t.id,t.languages[0].id),language:t.languages[0],dependencies:o})}else a.update({downloading:!1,tool:t,dependencies:[]})}function i(t,i){return e.presets.filter(function(e){return e.languages?0!==e.languages.filter(function(e){return e.id===i}).length&&(e.buildtool?e.buildtool===t:void 0):!!e.buildtool&&e.buildtool===t})}function n(e){var t=0;if(e.offsetParent){do{t+=e.offsetTop}while(e=e.offsetParent);return[t]}}var a=this,d=route.create();e.buildtools.forEach(function(e){d(e.id+"..",t.bind(a,e))}),d(t.bind(a,a.opts.buildtools[0])),this.changeLanguage=function(t){t.preventDefault();var n=a.language,d=a.tool.languages.filter(function(e){return e.id===t.target.value})[0];ga("send",{hitType:"event",eventCategory:d.id+":view",eventAction:d.id+"/view",eventLabel:"project"});var o=[].concat(a.dependencies);if(n)for(var c=0;c<o.length;c++){var s=o[c];"io.vertx"===s.groupId&&s.artifactId==="vertx-lang-"+n.id&&o.splice(c--,1)}e.components.forEach(function(e,t){if("io.vertx"===e.groupId&&e.artifactId==="vertx-lang-"+d.id&&0===o.filter(function(e){return e.id===t}).length){var i=clone(e);i.checked=!0,i.id=t,o.push(i)}}),a.update({downloading:!1,presets:i(a.tool.id,t.target.value),language:d,dependencies:o})}.bind(this),this.changePreset=function(t){t.preventDefault();var i=a.preset,n=a.presets.filter(function(e){return e.id===t.target.value})[0];ga("send",{hitType:"event",eventCategory:n.id+":view",eventAction:n.id+"/view",eventLabel:"project"});var d=[].concat(a.dependencies);if(i)for(var o=0;o<d.length;o++){var c=d[o];-1===i.dependencies.indexOf(c.groupId+":"+c.artifactId+(c.classifier?":"+c.classifier:""))?-1===i.dependencies.indexOf(c.groupId+":"+c.artifactId)||d.splice(o--,1):d.splice(o--,1)}e.components.forEach(function(e,t){var i;return-1!==n.dependencies.indexOf(e.groupId+":"+e.artifactId+(e.classifier?":"+e.classifier:""))&&0===d.filter(function(e){return e.id===t}).length?(i=clone(e),i.checked=!0,i.id=t,void d.push(i)):-1!==n.dependencies.indexOf(e.groupId+":"+e.artifactId)&&0===d.filter(function(e){return e.id===t}).length?(i=clone(e),i.checked=!0,i.id=t,void d.push(i)):void 0}),a.update({downloading:!1,preset:n,dependencies:d})}.bind(this),this.toggleDependency=function(e){a.dependencies[e.target.value].checked=!a.dependencies[e.target.value].checked,a.update({downloading:!1,dependencies:a.dependencies})}.bind(this),this.generate=function(t){t.preventDefault(),window.scroll(0,n(document.getElementById("interaction")));var i=t.target.submit,d=a.refs.download;i.disabled=!0,a.tool.fields.forEach(function(e){e.value=t.target[e.key].value}),compileProject({buildtool:a.tool,dependencies:a.dependencies,language:a.language,preset:a.preset,components:e.components},function(e,t){if(e)return i.disabled=!1,a.update({generating:!1}),alert(e);JSZip.support.blob?t.generateAsync({type:"blob",platform:"UNIX"}).then(function(e){"#"!==d.href&&(window.webkitURL||window.URL).revokeObjectURL(d.href),d.href=(window.webkitURL||window.URL).createObjectURL(e),i.disabled=!1,a.update({generating:!1,downloading:!0});try{document.getElementById("download-btn").focus(),document.getElementById("download-btn").click()}catch(e){}},function(e){ga("send","exception",{exDescription:e.message,exFatal:!0}),alert(e)}):t.generateAsync({type:"base64",platform:"UNIX"}).then(function(e){i.disabled=!1,a.update({generating:!1,downloading:!0}),window.location="data:application/zip;base64,"+e},function(e){ga("send","exception",{exDescription:e.message,exFatal:!0}),alert(e)})}),a.update({generating:!0,downloading:!1,name:t.target.name.value})}.bind(this),this.clean=function(e){setTimeout(function(){a.downloading=!1,a.update()},500)}.bind(this),this.search=function(t){var i=[].concat(a.dependencies.filter(function(e){return e.checked})),n=t.target.value;if(n.length>0){e.components.forEach(function(e,t){if(-1!==e.artifactId.indexOf(n)||e.description&&-1!==e.description.indexOf(n)){var a=clone(e);a.checked=!1,a.id=t,i.push(a),ctx++}}),ga("send",{hitType:"event",eventCategory:"search:fail",eventAction:n+"/fail",eventLabel:"component"})}a.update({dependencies:i})}.bind(this)}),riot.tag2("navigation",'<li each="{opts.buildtools}" class="nav-item"><a href="#{id}" onclick="{closeMenu}">&nbsp;&nbsp;{id}</a></li>',"","",function(e){this.closeMenu=function(e){document.getElementById("nav-trigger").checked=!1}.bind(this)}),function(e){"use strict";function t(){}function i(e,t,i,n){var a,d,o,c=t.indexOf("."),s=t.lastIndexOf("/");e.metadata.packageName&&(e.metadata.dirName=e.metadata.packageName.replace(/\./g,"/")),e.metadata.fileName=t.substring(s+1,c),d=(d=t.replace("{package}",e.metadata.dirName||"")).substr(d.indexOf("/")+1),a=t.replace("{package}/",""),o=Handlebars.templates[a],i?n.file(e.metadata.name.replace(/[ -]/g,"_")+"/"+d,o(e),{unixPermissions:"755"}):n.file(e.metadata.name.replace(/[ -]/g,"_")+"/"+d,o(e))}e.clone=function(e){return t.prototype=e,new t},e.loadJSON=function(e,t){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",e,!0),i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE){if(200!==i.status&&304!==i.status)return t("Failed to load the metadata!");t(null,i.responseText)}},i.send(null)},e.compileProject=function(e,t){var n,a=e.buildtool.executables||[];e.preset&&(a=a.concat(e.preset.executables||[])),ga("send",{hitType:"event",eventCategory:e.buildtool.id+":project",eventAction:e.buildtool.id+"/new",eventLabel:"project"}),e.dependenciesGAV={},e.dependencies.forEach(function(t){e.dependenciesGAV[t.groupId+":"+t.artifactId]=t.version,t.classifier&&(e.dependenciesGAV[t.groupId+":"+t.artifactId+":"+t.classifier]=t.version),ga("send",{hitType:"event",eventCategory:e.buildtool.id+":dependency",eventAction:e.buildtool.id+"/"+t.groupId+":"+t.artifactId+":"+t.version,eventLabel:"dependency"})}),e.bom=[],e.components.forEach(function(t){var i=clone(t);i.included=!1,e.bom.push(i)}),e.dependencies.forEach(function(t){e.bom[t.id].included=!0}),e.metadata={};var d=e.language.id;-1!==d.indexOf(" ")&&(d=d.substring(0,d.indexOf(" "))),e.metadata[d]=!0,e.metadata.artifactSuffix=e.buildtool["non-core-suffix"]||"",e.buildtool.fields.forEach(function(t){e.metadata[t.key]=t.value?t.value:t.prefill}),e.metadata.groupId&&(e.metadata.packageName=e.metadata.groupId+"."+(e.metadata.artifactId||e.metadata.name.replace(/[ -]/g,"_"))),e.metadata.main=e.language.main.replace("{package}",e.metadata.packageName||"");var o=new JSZip,c=[];for(c=c.concat(e.buildtool.templates),e.language.templates&&(c=c.concat(e.language.templates)),e.preset&&(c=c.concat(e.preset.templates||[]),e.preset.languages&&e.preset.languages[e.language.id]&&(c=c.concat(e.preset.languages[e.language.id].templates))),e.dependencies.forEach(function(e){c=c.concat(e.templates||[])}),n=0;n<c.length;n++)i(e,c[n],-1!==(a||[]).indexOf(c[n]),o);var s=e.buildtool.blob;e.preset&&(s=e.preset.blob||s),s?JSZipUtils.getBinaryContent(s,function(i,n){if(i)return ga("send","exception",{exDescription:i,exFatal:!0}),void t(i);o.loadAsync(n,{decodeFileName:function(t){return e.metadata.name.replace(/[ -]/g,"_")+"/"+String.fromCharCode.apply(null,t)}}).then(function(e){t(null,e)}).catch(function(e){ga("send","exception",{exDescription:e.message,exFatal:!0}),t(i)})}):t(null,o)}}(window);